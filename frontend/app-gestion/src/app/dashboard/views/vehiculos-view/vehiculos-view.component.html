<div class="vehiculos-container">
  
  <!-- HEADER -->
  <header class="page-header">
    <div>
      <h1>Gestión de Vehículos</h1>
      <p class="subtitle">Administra la flota de camiones recolectores</p>
    </div>
    <button class="btn-primary" (click)="abrirModal()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
      </svg>
      <span>Nuevo Vehículo</span>
    </button>
  </header>

  <!-- LOADING STATE -->
  <div *ngIf="loading()" class="loading-state">
    <div class="spinner"></div>
    <p>Cargando vehículos...</p>
  </div>

  <!-- EMPTY STATE -->
  <div *ngIf="!loading() && vehiculos().length === 0" class="empty-state">
    <div class="empty-icon">
      <svg viewBox="0 0 28 24" fill="none" stroke="#10b981" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="2" y="4" width="14" height="12" rx="1"/>
        <path d="M16 8h3l3 2v6h-3"/>
        <circle cx="6" cy="17" r="1.5"/>
        <circle cx="18" cy="17" r="1.5"/>
      </svg>
    </div>
    <h3>No hay vehículos registrados</h3>
    <p>Comienza agregando tu primer vehículo a la flota</p>
    <button class="btn-primary" (click)="abrirModal()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
      </svg>
      <span>Agregar Vehículo</span>
    </button>
  </div>

  <!-- TABLA DE VEHÍCULOS -->
  <div *ngIf="!loading() && vehiculos().length > 0" class="table-container">
    <table class="vehiculos-table">
      <thead>
        <tr>
          <th>Placa</th>
          <th>Marca</th>
          <th>Modelo</th>
          <th>Estado</th>
          <th>Fecha Registro</th>
          <th class="text-right">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let vehiculo of vehiculos()">
          <td>
            <div class="placa-badge">
              <svg viewBox="0 0 28 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="2" y="4" width="14" height="12" rx="1"/>
                <path d="M16 8h3l3 2v6h-3"/>
                <circle cx="6" cy="17" r="1.5"/>
                <circle cx="18" cy="17" r="1.5"/>
              </svg>
              <span>{{ vehiculo.placa }}</span>
            </div>
          </td>
          <td>{{ vehiculo.marca }}</td>
          <td>{{ vehiculo.modelo }}</td>
          <td>
            <span class="status-badge" [class.activo]="vehiculo.activo" [class.inactivo]="!vehiculo.activo">
              <span class="status-dot"></span>
              {{ vehiculo.activo ? 'Activo' : 'Inactivo' }}
            </span>
          </td>
          <td>
            <span class="fecha">
              {{ vehiculo.created_at ? (vehiculo.created_at | date:'dd/MM/yyyy') : '-' }}
            </span>
          </td>
          <td class="text-right">
            <div class="action-buttons">
              <button class="btn-icon" (click)="editarVehiculo(vehiculo)" title="Editar">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                  <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                </svg>
              </button>
              <button class="btn-icon" [class.danger]="vehiculo.activo" [class.success]="!vehiculo.activo" (click)="toggleActivo(vehiculo)" [title]="vehiculo.activo ? 'Desactivar' : 'Activar'">
                <svg *ngIf="vehiculo.activo" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="12" cy="12" r="10"></circle>
                  <line x1="15" y1="9" x2="9" y2="15"></line>
                  <line x1="9" y1="9" x2="15" y2="15"></line>
                </svg>
                <svg *ngIf="!vehiculo.activo" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
              </button>
              <button class="btn-icon delete" (click)="abrirModalEliminar(vehiculo)" title="Eliminar">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="3 6 5 6 21 6"></polyline>
                  <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                  <line x1="10" y1="11" x2="10" y2="17"></line>
                  <line x1="14" y1="11" x2="14" y2="17"></line>
                </svg>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- MODAL CREAR/EDITAR -->
  <div *ngIf="modalAbierto()" class="modal-overlay" (click)="cerrarModal()">
    <div class="modal-card" (click)="$event.stopPropagation()">
      
      <div class="modal-header">
        <h2>{{ modoEdicion() ? 'Editar Vehículo' : 'Nuevo Vehículo' }}</h2>
        <button class="btn-close" (click)="cerrarModal()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>

      <div class="modal-body">
        <div class="form-group">
          <label for="placa">Placa <span class="required">*</span></label>
          <input
            id="placa"
            type="text"
            [(ngModel)]="nuevoVehiculo.placa"
            placeholder="ABC-123"
            maxlength="7"
            [disabled]="modoEdicion()"
          />
          <small class="form-hint">Formato: 3 letras, guión, 3 números</small>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="marca">Marca <span class="required">*</span></label>
            <input
              id="marca"
              type="text"
              [(ngModel)]="nuevoVehiculo.marca"
              placeholder="Chevrolet, Ford, etc."
            />
          </div>

          <div class="form-group">
            <label for="modelo">Modelo <span class="required">*</span></label>
            <input
              id="modelo"
              type="text"
              [(ngModel)]="nuevoVehiculo.modelo"
              placeholder="2024"
            />
          </div>
        </div>

        <div class="form-group">
          <label class="checkbox-label">
            <input
              type="checkbox"
              [(ngModel)]="nuevoVehiculo.activo"
            />
            <span>Vehículo activo</span>
          </label>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn-secondary" (click)="cerrarModal()">Cancelar</button>
        <button class="btn-primary" (click)="modoEdicion() ? guardarEdicion() : crearVehiculo()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="20 6 9 17 4 12"></polyline>
          </svg>
          <span>{{ modoEdicion() ? 'Guardar Cambios' : 'Crear Vehículo' }}</span>
        </button>
      </div>

    </div>
  </div>

  <!-- MODAL CONFIRMAR ELIMINAR -->
  <div *ngIf="modalEliminarAbierto()" class="modal-overlay" (click)="cerrarModalEliminar()">
    <div class="modal-card modal-delete" (click)="$event.stopPropagation()">
      
      <div class="modal-header">
        <h2>Eliminar Vehículo</h2>
        <button class="btn-close" (click)="cerrarModalEliminar()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>

      <div class="modal-body delete-content">
        <div class="warning-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
            <line x1="12" y1="9" x2="12" y2="13"></line>
            <line x1="12" y1="17" x2="12.01" y2="17"></line>
          </svg>
        </div>
        <h3>¿Estás seguro de eliminar este vehículo?</h3>
        <p>El vehículo <strong>{{ vehiculoAEliminar?.placa }}</strong> será eliminado permanentemente. Esta acción no se puede deshacer.</p>
      </div>

      <div class="modal-footer">
        <button class="btn-secondary" (click)="cerrarModalEliminar()">Cancelar</button>
        <button class="btn-delete" (click)="confirmarEliminar()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="3 6 5 6 21 6"></polyline>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            <line x1="10" y1="11" x2="10" y2="17"></line>
            <line x1="14" y1="11" x2="14" y2="17"></line>
          </svg>
          <span>Eliminar Vehículo</span>
        </button>
      </div>

    </div>
  </div>

</div>