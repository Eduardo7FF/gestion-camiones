<div class="wrap">
  <!-- Sidebar -->
  <aside class="sidebar" [class.closed]="!menuAbierto()">
    <div class="brand">
      <div class="brand-text">Gestión de Camiones</div>
      <button class="burger" (click)="toggleMenu()">☰</button>
    </div>

    <nav class="menu">
      <a (click)="setTab('inicio')" [class.active]="tab() === 'inicio'">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M3 12L9 18L21 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span>Dashboard</span>
      </a>
      <a (click)="setTab('vehiculos')" [class.active]="tab() === 'vehiculos'">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M18 8H19C19.5304 8 20.0391 8.21071 20.4142 8.58579C20.7893 8.96086 21 9.46957 21 10V14C21 14.5304 20.7893 15.0391 20.4142 15.4142C20.0391 15.7893 19.5304 16 19 16H18M6 8H5C4.46957 8 3.96086 8.21071 3.58579 8.58579C3.21071 8.96086 3 9.46957 3 10V14C3 14.5304 3.21071 15.0391 3.58579 15.4142C3.96086 15.7893 4.46957 16 5 16H6M15 12H9M12 15V9M21 12V18C21 18.5304 20.7893 19.0391 20.4142 19.4142C20.0391 19.7893 19.5304 20 19 20H5C4.46957 20 3.96086 19.7893 3.58579 19.4142C3.21071 19.0391 3 18.5304 3 18V12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span>Vehículos</span>
      </a>
      <a (click)="setTab('recorridos')" [class.active]="tab() === 'recorridos'">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M13 3L17.25 7.25L13 11.5M11 21L6.75 16.75L11 12.5M21 12H3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span>Recorridos</span>
      </a>
      <a (click)="setTab('rutas')" [class.active]="tab() === 'rutas'">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span>Rutas</span>
      </a>
      <a (click)="setTab('calles')" [class.active]="tab() === 'calles'">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M13 19L20 12L13 5M3 12H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span>Calles</span>
      </a>
      <a (click)="setTab('administracion')" [class.active]="tab() === 'administracion'">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-2.572 1.065c-.94 1.543-3.31.826-2.37 2.37a1.724 1.724 0 00-1.066 2.573c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.572-1.065c-1.543.94-3.31.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 002.572-1.065c.94-1.543 3.31-.826 2.37-2.37a1.724 1.724 0 001.065-2.572z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span>Admin</span>
      </a>
    </nav>

    <div class="sidebar-footer">
      <div class="user">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Hola, <strong>{{ usuarioNombre }}</strong>
      </div>
      <button class="logout" (click)="logout()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h3.5a3 3 0 013 3v1" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Cerrar sesión
      </button>
    </div>
  </aside>

  <!-- Main content -->
  <main class="main" [class.expanded]="!menuAbierto()">
    <!-- Sistema de notificaciones -->
    <div class="notificacion" *ngIf="notificacion()" [class]="'notificacion ' + notificacion()!.tipo">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path *ngIf="notificacion()!.tipo === 'success'" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path *ngIf="notificacion()!.tipo === 'error'" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path *ngIf="notificacion()!.tipo === 'info'" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      {{ notificacion()!.mensaje }}
    </div>

    <!-- Panel de clima -->
    <div class="clima-panel">
      <div class="clima-info">
        <div class="clima-icon">
          <svg *ngIf="clima.icono === 'sunny'" width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="sunny">
            <circle cx="12" cy="12" r="5" stroke="currentColor" stroke-width="2"/>
            <line x1="12" y1="1" x2="12" y2="3" stroke="currentColor" stroke-width="2"/>
            <line x1="12" y1="21" x2="12" y2="23" stroke="currentColor" stroke-width="2"/>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" stroke="currentColor" stroke-width="2"/>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" stroke="currentColor" stroke-width="2"/>
            <line x1="1" y1="12" x2="3" y2="12" stroke="currentColor" stroke-width="2"/>
            <line x1="21" y1="12" x2="23" y2="12" stroke="currentColor" stroke-width="2"/>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" stroke="currentColor" stroke-width="2"/>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" stroke="currentColor" stroke-width="2"/>
          </svg>
          <svg *ngIf="clima.icono === 'cloudy'" width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="cloudy">
            <path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <svg *ngIf="clima.icono === 'rainy'" width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="rainy">
            <path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <line x1="8" y1="19" x2="8" y2="21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <line x1="8" y1="13" x2="8" y2="15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <line x1="16" y1="19" x2="16" y2="21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <line x1="16" y1="13" x2="16" y2="15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <line x1="12" y1="21" x2="12" y2="23" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <line x1="12" y1="15" x2="12" y2="17" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
          <svg *ngIf="clima.icono === 'stormy'" width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="night">
            <path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <polygon points="13 11 17 17 11 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <div class="clima-detalle">
          <div class="temperatura">{{ clima.temperatura }}°C</div>
          <div class="condicion">{{ clima.condicion | titlecase }}</div>
        </div>
      </div>
      <div class="clima-stats">
        <div class="stat-item">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 2v2m0 16v2M4 12H2m20 0h-2m-4-8l-1.414 1.414M7.414 16.586L5.999 18m12.586-4.586l1.414-1.414M16.586 7.414l1.414-1.414M7.414 7.414L5.999 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span>Humedad: {{ clima.humedad }}%</span>
        </div>
        <div class="stat-item">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span>Viento: {{ clima.velocidadViento }} km/h</span>
        </div>
      </div>
    </div>

    <header class="header">
      <h2 *ngIf="tab() === 'inicio'">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M3 12L9 18L21 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Dashboard
      </h2>
      <h2 *ngIf="tab() === 'vehiculos'">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M18 8H19C19.5304 8 20.0391 8.21071 20.4142 8.58579C20.7893 8.96086 21 9.46957 21 10V14C21 14.5304 20.7893 15.0391 20.4142 15.4142C20.0391 15.7893 19.5304 16 19 16H18M6 8H5C4.46957 8 3.96086 8.21071 3.58579 8.58579C3.21071 8.96086 3 9.46957 3 10V14C3 14.5304 3.21071 15.0391 3.58579 15.4142C3.96086 15.7893 4.46957 16 5 16H6M15 12H9M12 15V9M21 12V18C21 18.5304 20.7893 19.0391 20.4142 19.4142C20.0391 19.7893 19.5304 20 19 20H5C4.46957 20 3.96086 19.7893 3.58579 19.4142C3.21071 19.0391 3 18.5304 3 18V12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Vehículos
      </h2>
      <h2 *ngIf="tab() === 'recorridos'">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M13 3L17.25 7.25L13 11.5M11 21L6.75 16.75L11 12.5M21 12H3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Recorridos
      </h2>
      <h2 *ngIf="tab() === 'rutas'">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Rutas
      </h2>
      <h2 *ngIf="tab() === 'calles'">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M13 19L20 12L13 5M3 12H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Calles
      </h2>
      <h2 *ngIf="tab() === 'administracion'">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-2.572 1.065c-.94 1.543-3.31.826-2.37 2.37a1.724 1.724 0 00-1.066 2.573c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.572-1.065c-1.543.94-3.31.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 002.572-1.065c.94-1.543 3.31-.826 2.37-2.37a1.724 1.724 0 001.065-2.572z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Administración
      </h2>
      
      <!-- Botón para crear nuevo elemento -->
      <div class="header-actions" *ngIf="tab() === 'vehiculos'">
        <button (click)="abrirModalCrearVehiculo()" class="btn-primary">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Nuevo Vehículo
        </button>
      </div>
      <div class="header-actions" *ngIf="tab() === 'rutas'">
        <button (click)="crearRutaConCallesPrimeras()" class="btn-primary">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Nueva Ruta (con calles)
        </button>
      </div>
    </header>

    <!-- INICIO: Dashboard con estadísticas -->
    <section *ngIf="tab() === 'inicio'" class="panel">
      <div class="stats">
        <div class="stat">
          <div class="stat-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M18 8H19C19.5304 8 20.0391 8.21071 20.4142 8.58579C20.7893 8.96086 21 9.46957 21 10V14C21 14.5304 20.7893 15.0391 20.4142 15.4142C20.0391 15.7893 19.5304 16 19 16H18M6 8H5C4.46957 8 3.96086 8.21071 3.58579 8.58579C3.21071 8.96086 3 9.46957 3 10V14C3 14.5304 3.21071 15.0391 3.58579 15.4142C3.96086 15.7893 4.46957 16 5 16H6M15 12H9M12 15V9M21 12V18C21 18.5304 20.7893 19.0391 20.4142 19.4142C20.0391 19.7893 19.5304 20 19 20H5C4.46957 20 3.96086 19.7893 3.58579 19.4142C3.21071 19.0391 3 18.5304 3 18V12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <h3>{{ vehiculos.length }}</h3>
          <p>Vehículos</p>
        </div>
        <div class="stat">
          <div class="stat-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M13 3L17.25 7.25L13 11.5M11 21L6.75 16.75L11 12.5M21 12H3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <h3>{{ recorridos.length }}</h3>
          <p>Recorridos</p>
        </div>
        <div class="stat">
          <div class="stat-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <h3>{{ rutas.length }}</h3>
          <p>Rutas/Asignaciones</p>
        </div>
      </div>

      <div class="two-col">
        <!-- Tabla Vehículos -->
        <div class="box">
          <div class="box-header">
            <h3>
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M18 8H19C19.5304 8 20.0391 8.21071 20.4142 8.58579C20.7893 8.96086 21 9.46957 21 10V14C21 14.5304 20.7893 15.0391 20.4142 15.4142C20.0391 15.7893 19.5304 16 19 16H18M6 8H5C4.46957 8 3.96086 8.21071 3.58579 8.58579C3.21071 8.96086 3 9.46957 3 10V14C3 14.5304 3.21071 15.0391 3.58579 15.4142C3.96086 15.7893 4.46957 16 5 16H6M15 12H9M12 15V9M21 12V18C21 18.5304 20.7893 19.0391 20.4142 19.4142C20.0391 19.7893 19.5304 20 19 20H5C4.46957 20 3.96086 19.7893 3.58579 19.4142C3.21071 19.0391 3 18.5304 3 18V12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Vehículos
            </h3>
          </div>
          <p *ngIf="!vehiculos.length">Aún no hay vehículos registrados.</p>
          <table *ngIf="vehiculos.length">
            <thead>
              <tr>
                <th>Placa</th>
                <th>Modelo</th>
                <th>Marca</th>
                <th>Fecha Registro</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let v of vehiculos.slice(0, 5)">
                <td>{{ v.placa }}</td>
                <td>{{ v.modelo || '-' }}</td>
                <td>{{ v.marca || '-' }}</td>
                <td>{{ v.created_at ? (v.created_at | date:'dd/MM/yyyy HH:mm') : 'N/A' }}</td>
                <td><button (click)="eliminarVehiculo(v.id)" class="btn-danger">Eliminar</button></td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Tabla Recorridos -->
        <div class="box">
          <div class="box-header">
            <h3>
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M13 3L17.25 7.25L13 11.5M11 21L6.75 16.75L11 12.5M21 12H3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Recorridos
            </h3>
          </div>
          <p *ngIf="!recorridos.length">Aún no hay recorridos.</p>
          <table *ngIf="recorridos.length">
            <thead>
              <tr>
                <th>Ruta</th>
                <th>Vehículo</th>
                <th>Fecha</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let r of recorridos.slice(0, 5)">
                <td>{{ r.ruta_id.substring(0, 8) }}...</td>
                <td>{{ r.vehiculo_id.substring(0, 8) }}...</td>
                <td>{{ r.created_at ? (r.created_at | date:'dd/MM/yyyy HH:mm') : 'N/A' }}</td>
                <td>
                  <button (click)="finalizarRecorrido(r.id)" class="btn-warning">Finalizar</button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- VEHÍCULOS -->
    <section *ngIf="tab() === 'vehiculos'" class="panel">
      <!-- Filtro de búsqueda -->
      <div class="filtro-container">
        <input 
          type="text" 
          class="filtro-input" 
          placeholder="Buscar por placa, marca o modelo..." 
          [value]="filtroVehiculos()"
          (input)="filtroVehiculos.set($any($event.target).value)"
        />
        <span class="filtro-info">{{ vehiculosFiltrados().length }} resultados</span>
      </div>

      <p *ngIf="!vehiculosPaginados().length">No se encontraron vehículos.</p>
      <table *ngIf="vehiculosPaginados().length" class="full-table">
        <thead>
          <tr>
            <th>Placa</th>
            <th>Modelo</th>
            <th>Marca</th>
            <th>Activo</th>
            <th>Fecha Registro</th>
            <th>Acción</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let v of vehiculosPaginados()">
            <td>{{ v.placa }}</td>
            <td>{{ v.modelo || '-' }}</td>
            <td>{{ v.marca || '-' }}</td>
            <td>{{ v.activo ? 'Sí' : 'No' }}</td>
            <td>{{ v.created_at ? (v.created_at | date:'dd/MM/yyyy HH:mm') : 'N/A' }}</td>
            <td>
              <div class="acciones-boton">
                <button (click)="eliminarVehiculo(v.id)" class="btn-danger">Eliminar</button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Paginación -->
      <div class="paginacion" *ngIf="totalPaginasVehiculos() > 1">
        <button (click)="cambiarPaginaVehiculos(-1)" [disabled]="paginaVehiculos() === 1" class="btn-pagination">
          Anterior
        </button>
        <span>Página {{ paginaVehiculos() }} de {{ totalPaginasVehiculos() }}</span>
        <button (click)="cambiarPaginaVehiculos(1)" [disabled]="paginaVehiculos() === totalPaginasVehiculos()" class="btn-pagination">
          Siguiente
        </button>
      </div>
    </section>

    <!-- RECORRIDOS -->
    <section *ngIf="tab() === 'recorridos'" class="panel">
      <!-- Filtro de búsqueda -->
      <div class="filtro-container">
        <input 
          type="text" 
          class="filtro-input" 
          placeholder="Buscar por ID de recorrido, ruta o vehículo..." 
          [value]="filtroRecorridos()"
          (input)="filtroRecorridos.set($any($event.target).value)"
        />
        <span class="filtro-info">{{ recorridosFiltrados().length }} resultados</span>
      </div>

      <p *ngIf="!recorridosPaginados().length">No se encontraron recorridos.</p>
      <table *ngIf="recorridosPaginados().length" class="full-table">
        <thead>
          <tr>
            <th>ID Recorrido</th>
            <th>Ruta ID</th>
            <th>Vehículo ID</th>
            <th>Fecha Inicio</th>
            <th>Acción</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let r of recorridosPaginados()">
            <td>{{ r.id.substring(0, 8) }}...</td>
            <td>{{ r.ruta_id.substring(0, 8) }}...</td>
            <td>{{ r.vehiculo_id.substring(0, 8) }}...</td>
            <td>{{ r.created_at ? (r.created_at | date:'dd/MM/yyyy HH:mm') : 'N/A' }}</td>
            <td>
              <div class="acciones-boton">
                <button (click)="verPosiciones(r.id)" class="btn-info">Ver Posiciones</button>
                <button (click)="iniciarSeguimientoRecorrido(r.id)" class="btn-success">Seguimiento</button>
                <button (click)="finalizarRecorrido(r.id)" class="btn-warning">Finalizar</button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Paginación -->
      <div class="paginacion" *ngIf="totalPaginasRecorridos() > 1">
        <button (click)="cambiarPaginaRecorridos(-1)" [disabled]="paginaRecorridos() === 1" class="btn-pagination">
          Anterior
        </button>
        <span>Página {{ paginaRecorridos() }} de {{ totalPaginasRecorridos() }}</span>
        <button (click)="cambiarPaginaRecorridos(1)" [disabled]="paginaRecorridos() === totalPaginasRecorridos()" class="btn-pagination">
          Siguiente
        </button>
      </div>
    </section>

    <!-- RUTAS -->
    <section *ngIf="tab() === 'rutas'" class="panel">
      <!-- Filtro de búsqueda -->
      <div class="filtro-container">
        <input 
          type="text" 
          class="filtro-input" 
          placeholder="Buscar por nombre de ruta..." 
          [value]="filtroRutas()"
          (input)="filtroRutas.set($any($event.target).value)"
        />
        <span class="filtro-info">{{ rutasFiltradas().length }} resultados</span>
      </div>

      <p *ngIf="!rutasPaginadas().length">No se encontraron rutas.</p>
      <table *ngIf="rutasPaginadas().length" class="full-table">
        <thead>
          <tr>
            <th>Nombre Ruta</th>
            <th>Color</th>
            <th>Fecha Creación</th>
            <th>Acción</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let ruta of rutasPaginadas()">
            <td>{{ ruta.nombre_ruta }}</td>
            <td>
              <span class="color-badge" [style.background-color]="ruta.color_hex || '#25D366'"></span>
              {{ ruta.color_hex || '#25D366' }}
            </td>
            <td>{{ ruta.created_at ? (ruta.created_at | date:'dd/MM/yyyy HH:mm') : 'N/A' }}</td>
            <td>
              <div class="acciones-boton">
                <button (click)="verDetalleRuta(ruta.id)" class="btn-info">Ver Detalle</button>
                <button (click)="iniciarSeguimientoRuta(ruta.id)" class="btn-success">Seguimiento</button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Paginación -->
      <div class="paginacion" *ngIf="totalPaginasRutas() > 1">
        <button (click)="cambiarPaginaRutas(-1)" [disabled]="paginaRutas() === 1" class="btn-pagination">
          Anterior
        </button>
        <span>Página {{ paginaRutas() }} de {{ totalPaginasRutas() }}</span>
        <button (click)="cambiarPaginaRutas(1)" [disabled]="paginaRutas() === totalPaginasRutas()" class="btn-pagination">
          Siguiente
        </button>
      </div>
    </section>

    <!-- CALLES -->
    <section *ngIf="tab() === 'calles'" class="panel">
      <!-- Filtro de búsqueda -->
      <div class="filtro-container">
        <input 
          type="text" 
          class="filtro-input" 
          placeholder="Buscar por nombre de calle..." 
          [value]="filtroCalles()"
          (input)="filtroCalles.set($any($event.target).value)"
        />
        <span class="filtro-info">{{ callesFiltradas().length }} resultados</span>
      </div>

      <p *ngIf="!callesPaginadas().length">No se encontraron calles.</p>
      <table *ngIf="callesPaginadas().length" class="full-table">
        <thead>
          <tr>
            <th>Nombre</th>
            <th>ID</th>
            <th>Acción</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let calle of callesPaginadas()">
            <td>{{ calle.nombre }}</td>
            <td>{{ calle.id.substring(0, 13) }}...</td>
            <td><button (click)="verDetalleCalle(calle.id)" class="btn-info">Ver Geometría</button></td>
          </tr>
        </tbody>
      </table>

      <!-- Paginación -->
      <div class="paginacion" *ngIf="totalPaginasCalles() > 1">
        <button (click)="cambiarPaginaCalles(-1)" [disabled]="paginaCalles() === 1" class="btn-pagination">
          Anterior
        </button>
        <span>Página {{ paginaCalles() }} de {{ totalPaginasCalles() }}</span>
        <button (click)="cambiarPaginaCalles(1)" [disabled]="paginaCalles() === totalPaginasCalles()" class="btn-pagination">
          Siguiente
        </button>
      </div>
    </section>
    
    <!-- ADMINISTRACIÓN -->
    <section *ngIf="tab() === 'administracion'" class="panel">
      <div class="box">
        <div class="box-header">
          <h3>
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-2.572 1.065c-.94 1.543-3.31.826-2.37 2.37a1.724 1.724 0 00-1.066 2.573c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.572-1.065c-1.543.94-3.31.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 002.572-1.065c.94-1.543 3.31-.826 2.37-2.37a1.724 1.724 0 001.065-2.572z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Administración de Rutas y Vehículos
          </h3>
        </div>
        
        <div class="settings-grid">
          <div class="settings-column">
            <div class="form-group">
              <label>Seleccionar Ruta</label>
              <select [(ngModel)]="rutaSeleccionadaId">
                <option value="">Seleccione una ruta</option>
                <option *ngFor="let r of rutas" [value]="r.id">{{ r.nombre_ruta }}</option>
              </select>
            </div>
            
            <div class="form-group">
              <label>Seleccionar Vehículo</label>
              <select [(ngModel)]="vehiculoSeleccionadoId">
                <option value="">Seleccione un vehículo</option>
                <option *ngFor="let v of vehiculos" [value]="v.id">{{ v.placa }} - {{ v.marca }}</option>
              </select>
            </div>
          </div>
          
          <div class="settings-column">
            <div class="form-group">
              <label>Nombre de Ruta</label>
              <input type="text" [(ngModel)]="rutaNueva.nombre_ruta" placeholder="Nombre de la ruta">
            </div>
            
            <div class="form-group">
              <label>Color</label>
              <input type="color" [(ngModel)]="rutaNueva.color_hex">
            </div>
          </div>
        </div>
        
        <div class="settings-actions">
          <button (click)="crearRutaConEjemplo()" class="btn-primary">Crear Ruta Ejemplo</button>
          <button (click)="iniciarRecorridoEjemplo()" class="btn-success">Iniciar Recorrido</button>
        </div>
      </div>
    </section>
    
    <!-- Modal para crear vehículo -->
    <div class="modal" *ngIf="modalCrearVehiculoAbierto">
      <div class="modal-card">
        <h3>
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M18 8H19C19.5304 8 20.0391 8.21071 20.4142 8.58579C20.7893 8.96086 21 9.46957 21 10V14C21 14.5304 20.7893 15.0391 20.4142 15.4142C20.0391 15.7893 19.5304 16 19 16H18M6 8H5C4.46957 8 3.96086 8.21071 3.58579 8.58579C3.21071 8.96086 3 9.46957 3 10V14C3 14.5304 3.21071 15.0391 3.58579 15.4142C3.96086 15.7893 4.46957 16 5 16H6M15 12H9M12 15V9M21 12V18C21 18.5304 20.7893 19.0391 20.4142 19.4142C20.0391 19.7893 19.5304 20 19 20H5C4.46957 20 3.96086 19.7893 3.58579 19.4142C3.21071 19.0391 3 18.5304 3 18V12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Crear Nuevo Vehículo
        </h3>
        <input 
          type="text" 
          placeholder="Placa" 
          [(ngModel)]="vehiculoNuevo.placa"
        />
        <input 
          type="text" 
          placeholder="Marca" 
          [(ngModel)]="vehiculoNuevo.marca"
        />
        <input 
          type="text" 
          placeholder="Modelo" 
          [(ngModel)]="vehiculoNuevo.modelo"
        />
        <label class="switch-label">
          <input 
            type="checkbox" 
            [(ngModel)]="vehiculoNuevo.activo"
          /> 
          <span class="switch-slider"></span>
          <span class="switch-text">Activo</span>
        </label>
        
        <div class="modal-actions">
          <button (click)="cerrarModalCrearVehiculo()" class="btn-cancel">Cancelar</button>
          <button (click)="guardarVehiculo()" class="btn-primary">Crear</button>
        </div>
      </div>
    </div>
    
    <!-- Modal para crear ruta -->
    <div class="modal" *ngIf="modalCrearRutaAbierta">
      <div class="modal-card">
        <h3>
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Crear Nueva Ruta
        </h3>
        <input 
          type="text" 
          placeholder="Nombre de la ruta" 
          [(ngModel)]="rutaNueva.nombre_ruta"
        />
        <input 
          type="text" 
          placeholder="Color hexadecimal (opcional)" 
          [(ngModel)]="rutaNueva.color_hex"
        />
        
        <div class="modal-actions">
          <button (click)="cerrarModalCrearRuta()" class="btn-cancel">Cancelar</button>
          <button (click)="guardarRuta()" class="btn-primary">Crear</button>
        </div>
      </div>
    </div>
    
    <!-- Modal para ver detalle de calle -->
    <div class="modal" *ngIf="modalCalleAbierto">
      <div class="modal-card">
        <h3>
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M13 19L20 12L13 5M3 12H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Detalle de Calle
        </h3>
        <p><strong>Nombre:</strong> {{ calleSeleccionada?.nombre }}</p>
        <p><strong>ID:</strong> {{ calleSeleccionada?.id }}</p>
        <p><strong>Geometría:</strong></p>
        <pre>{{ calleSeleccionada?.shape }}</pre>
        
        <div class="modal-actions">
          <button (click)="cerrarModalCalle()" class="btn-cancel">Cerrar</button>
        </div>
      </div>
    </div>
  </main>
</div>