<div class="wrap">
  <aside class="sidebar" [class.closed]="!menuAbierto()">
    <div class="brand">
      <div class="brand-text">Gestión de Camiones</div>
      <button class="burger" (click)="toggleMenu()">☰</button>
    </div>

    <nav class="menu">
      <a (click)="setTab('inicio')" [class.active]="tab() === 'inicio'">
        <!-- icon home -->
        <svg width="18" height="18" viewBox="0 0 24 24"><path fill="currentColor" d="M12 3l9 8h-3v9h-5v-6H11v6H6v-9H3z"/></svg>
        <span>Dashboard</span>
      </a>
      <a (click)="setTab('camiones')" [class.active]="tab() === 'camiones'">
        <svg width="18" height="18" viewBox="0 0 24 24"><path fill="currentColor" d="M3 7h13v7H3zM20 8h1v6h-1zM16 3h4v5h-4zM5 17a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm12 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4z"/></svg>
        <span>Camiones</span>
      </a>
      <a (click)="setTab('choferes')" [class.active]="tab() === 'choferes'">
        <svg width="18" height="18" viewBox="0 0 24 24"><path fill="currentColor" d="M12 12a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 2c-4 0-7 2-7 4v2h14v-2c0-2-3-4-7-4z"/></svg>
        <span>Choferes</span>
      </a>
      <a (click)="setTab('rutas')" [class.active]="tab() === 'rutas'">
        <svg width="18" height="18" viewBox="0 0 24 24"><path fill="currentColor" d="M3 3h18v2H3zM5 7h14v2H5zM7 11h10v2H7zM9 15h6v2H9z"/></svg>
        <span>Rutas</span>
      </a>
      <a (click)="setTab('asignaciones')" [class.active]="tab() === 'asignaciones'">
        <svg width="18" height="18" viewBox="0 0 24 24"><path fill="currentColor" d="M12 3l4 4h-3v6h-2V7H8zM4 13h16v8H4z" /></svg>
        <span>Asignaciones</span>
      </a>
      <a (click)="setTab('reportes')" [class.active]="tab() === 'reportes'">
        <svg width="18" height="18" viewBox="0 0 24 24"><path fill="currentColor" d="M3 13h4v-6H3v6zm6 0h4V7H9v6zm6 0h4V3h-4v10z"/></svg>
        <span>Reportes</span>
      </a>
      <a (click)="setTab('config')" [class.active]="tab() === 'config'">
        <svg width="18" height="18" viewBox="0 0 24 24"><path fill="currentColor" d="M12 8a4 4 0 1 0 0 8 4 4 0 0 0 0-8zM2 12a9.99 9.99 0 0 1 1.17-4.4l2.23.64A7 7 0 0 0 6 12c0 .7.1 1.38.3 2.02l-2.23.64A9.99 9.99 0 0 1 2 12z"/></svg>
        <span>Configuración</span>
      </a>
    </nav>

    <div class="sidebar-footer">
      <div class="user">Hola, <strong>{{ usuarioNombre }}</strong></div>
      <button class="logout" (click)="logout()">Cerrar sesión</button>
    </div>
  </aside>

  <main class="main">
    <header class="header">
      <h2 *ngIf="tab() === 'inicio'">Dashboard</h2>
      <h2 *ngIf="tab() === 'camiones'">Camiones</h2>
      <h2 *ngIf="tab() === 'choferes'">Choferes</h2>
      <h2 *ngIf="tab() === 'rutas'">Rutas</h2>
      <h2 *ngIf="tab() === 'asignaciones'">Asignaciones</h2>
      <h2 *ngIf="tab() === 'reportes'">Reportes</h2>
      <h2 *ngIf="tab() === 'config'">Configuración</h2>
      <div class="header-actions">
        <button *ngIf="tab() === 'camiones'" (click)="modalCamion = true">Agregar camión</button>
        <button *ngIf="tab() === 'choferes'" (click)="modalChofer = true">Agregar chofer</button>
        <button *ngIf="tab() === 'asignaciones'" (click)="modalAsignacion = true">Asignar nuevo</button>
      </div>
    </header>

    <!-- INICIO: estadísticas resumen -->
    <section *ngIf="tab() === 'inicio'" class="panel">
      <div class="stats">
        <div class="stat"><h3>{{ camiones.length }}</h3><p>Camiones</p></div>
        <div class="stat"><h3>{{ choferes.length }}</h3><p>Choferes</p></div>
        <div class="stat"><h3>{{ asignaciones.length }}</h3><p>Rutas/Asignaciones</p></div>
      </div>

      <div class="two-col">
        <div class="box">
          <h3>Camiones</h3>
          <p *ngIf="!camiones.length">Aún no hay camiones registrados.</p>
          <table *ngIf="camiones.length">
            <thead><tr><th>Placa</th><th>Modelo</th><th>Capacidad</th><th>Fecha registro</th><th></th></tr></thead>
            <tbody>
              <tr *ngFor="let c of camiones; let i=index">
                <td>{{ c.placa }}</td>
                <td>{{ c.modelo }}</td>
                <td>{{ c.capacidad }}</td>
                <td>{{ c.fechaRegistro | date:'dd/MM/yyyy' }}</td>
                <td><button (click)="borrarCamion(i)">Eliminar</button></td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="box">
          <h3>Choferes</h3>
          <p *ngIf="!choferes.length">Aún no hay choferes.</p>
          <table *ngIf="choferes.length">
            <thead><tr><th>Nombre</th><th>Cédula</th><th>Teléfono</th><th>Ingreso</th><th></th></tr></thead>
            <tbody>
              <tr *ngFor="let ch of choferes; let i=index">
                <td>{{ ch.nombre }}</td>
                <td>{{ ch.cedula }}</td>
                <td>{{ ch.telefono }}</td>
                <td>{{ ch.fechaIngreso | date:'dd/MM/yyyy' }}</td>
                <td><button (click)="borrarChofer(i)">Eliminar</button></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- CAMIONES -->
    <section *ngIf="tab() === 'camiones'" class="panel">
      <p *ngIf="!camiones.length">Aún no hay camiones. Usa "Agregar camión".</p>
      <table *ngIf="camiones.length" class="full-table">
        <thead><tr><th>Placa</th><th>Modelo</th><th>Capacidad</th><th>Fecha registro</th><th>Acción</th></tr></thead>
        <tbody>
          <tr *ngFor="let c of camiones; let i=index">
            <td>{{ c.placa }}</td>
            <td>{{ c.modelo }}</td>
            <td>{{ c.capacidad }}</td>
            <td>{{ c.fechaRegistro | date:'dd/MM/yyyy' }}</td>
            <td><button (click)="borrarCamion(i)">Eliminar</button></td>
          </tr>
        </tbody>
      </table>
    </section>

    <!-- CHOFERES -->
    <section *ngIf="tab() === 'choferes'" class="panel">
      <p *ngIf="!choferes.length">Aún no hay choferes. Usa "Agregar chofer".</p>
      <table *ngIf="choferes.length" class="full-table">
        <thead><tr><th>Nombre</th><th>Cédula</th><th>Teléfono</th><th>Ingreso</th><th>Acción</th></tr></thead>
        <tbody>
          <tr *ngFor="let ch of choferes; let i=index">
            <td>{{ ch.nombre }}</td>
            <td>{{ ch.cedula }}</td>
            <td>{{ ch.telefono }}</td>
            <td>{{ ch.fechaIngreso | date:'dd/MM/yyyy' }}</td>
            <td><button (click)="borrarChofer(i)">Eliminar</button></td>
          </tr>
        </tbody>
      </table>
    </section>

    <!-- RUTAS (placeholder) -->
    <section *ngIf="tab() === 'rutas'" class="panel">
    
    <p>Aún no hay rutas definidas. (Aquí luego podrás crear/editar rutas y ver mapa)</p>
    </section>

    <!-- ASIGNACIONES -->
    <section *ngIf="tab() === 'asignaciones'" class="panel">
      <p *ngIf="!asignaciones.length">Aún no hay asignaciones.</p>
      <table *ngIf="asignaciones.length" class="full-table">
        <thead><tr><th>Camión</th><th>Chofer</th><th>Ruta</th><th>Fecha</th></tr></thead>
        <tbody>
          <tr *ngFor="let a of asignaciones">
            <td>{{ a.camion }}</td>
            <td>{{ a.chofer }}</td>
            <td>{{ a.ruta }}</td>
            <td>{{ a.fecha | date:'dd/MM/yyyy HH:mm' }}</td>
          </tr>
        </tbody>
      </table>
    </section>

    <!-- REPORTES -->
    <section *ngIf="tab() === 'reportes'" class="panel">
  
    <p>No hay reportes todavía.</p>
    </section>

<section *ngIf="tab() === 'config'" class="panel">
  <div class="config-container">
    <p class="config-subtitle">
      Administra tu perfil, apariencia, seguridad y preferencias generales.
    </p>

    <div class="settings-card">
      <h3 class="section-heading">Perfil del Usuario</h3>
      <div class="settings-grid">
        <div class="settings-column">
          <div class="form-group">
            <label>ID de Usuario</label>
            <input type="text" value="USR-00123" disabled />
          </div>
          <div class="form-group">
            <label>Nombre Completo</label>
            <input type="text" [(ngModel)]="usuarioNombre" />
          </div>
          <div class="form-group">
            <label>Correo Electrónico</label>
            <input type="email" value="usuario@empresa.com" />
          </div>
          <div class="form-group">
            <label>Estado</label>
            <input type="text" value="Activo" disabled />
          </div>
        </div>

        <div class="settings-column">
          <div class="form-group">
            <label>Contraseña Actual</label>
            <input type="password" placeholder="••••••••" />
          </div>
          <div class="form-group">
            <label>Nueva Contraseña</label>
            <input type="password" placeholder="Ingrese nueva contraseña" />
          </div>
          <div class="form-group">
            <label>Confirmar Contraseña</label>
            <input type="password" placeholder="Repita la contraseña" />
          </div>
        </div>
      </div>

      <div class="settings-actions">
        <button class="save-btn">Guardar Cambios</button>
        <button class="cancel-btn">Cancelar</button>
      </div>
    </div>

    <!-- Apariencia y Preferencias -->
    <div class="settings-card">
      <h3 class="section-heading">Preferencias y Apariencia</h3>
      <div class="settings-extra">
        <div class="form-group">
          <label>Tema de la Interfaz</label>
          <select>
            <option>Claro</option>
            <option>Oscuro</option>
            <option>Automático</option>
          </select>
        </div>
        <div class="form-group">
          <label>Idioma</label>
          <select>
            <option>Español</option>
            <option>Inglés</option>
            <option>Francés</option>
          </select>
        </div>
      </div>

      <div class="notifications">
        <h4>Notificaciones</h4>
        <div class="toggle-row">
          <span>Alertas del sistema</span>
          <label class="switch">
            <input type="checkbox" checked />
            <span class="slider"></span>
          </label>
        </div>
        <div class="toggle-row">
          <span>Reportes semanales</span>
          <label class="switch">
            <input type="checkbox" />
            <span class="slider"></span>
          </label>
        </div>
        <div class="toggle-row">
          <span>Asignaciones automáticas</span>
          <label class="switch">
            <input type="checkbox" checked />
            <span class="slider"></span>
          </label>
        </div>
      </div>
    </div>

    <!-- Seguridad -->
    <div class="settings-card">
      <h3 class="section-heading">Seguridad y Sesión</h3>
      <div class="security-grid">
        <div class="form-group">
          <label>Autenticación en Dos Pasos (2FA)</label>
          <div class="toggle-row">
            <span>Habilitar verificación adicional</span>
            <label class="switch">
              <input type="checkbox" />
              <span class="slider"></span>
            </label>
          </div>
        </div>

        <div class="form-group">
          <label>Actividad Reciente</label>
          <p style="font-size: 0.9rem; color: #555;">Último inicio de sesión: <strong>05/11/2025 21:30</strong></p>
          <p style="font-size: 0.9rem; color: #555;">Dispositivo: <strong>Windows 10 - Chrome</strong></p>
        </div>
      </div>
      <div class="settings-actions">
        <button class="save-btn">Cerrar todas las sesiones</button>
      </div>
    </div>

    <!-- Almacenamiento -->
    <div class="settings-card">
      <h3 class="section-heading">Almacenamiento Local</h3>
      <p style="color: #555;">Borra la información almacenada localmente en tu navegador.</p>
      <div class="settings-actions">
        <button class="cancel-btn" (click)="limpiarDatosLocales()">Limpiar Datos</button>
      </div>
    </div>
  </div>
</section>



<!-- MODALES DE FORM -->
<div class="modal" *ngIf="modalCamion">
  <div class="modal-card">
    <h3>Agregar Camión</h3>
    <input [(ngModel)]="nuevoCamion.placa" placeholder="Placa" />
    <input [(ngModel)]="nuevoCamion.modelo" placeholder="Modelo" />
    <input [(ngModel)]="nuevoCamion.capacidad" placeholder="Capacidad" />
    <div class="modal-actions">
      <button (click)="modalCamion=false">Cancelar</button>
      <button (click)="agregarCamion()">Guardar</button>
    </div>
  </div>
</div>

<div class="modal" *ngIf="modalChofer">
  <div class="modal-card">
    <h3>Agregar Chofer</h3>
    <input [(ngModel)]="nuevoChofer.nombre" placeholder="Nombre" />
    <input [(ngModel)]="nuevoChofer.cedula" placeholder="Cédula" />
    <input [(ngModel)]="nuevoChofer.telefono" placeholder="Teléfono" />
    <div class="modal-actions">
      <button (click)="modalChofer=false">Cancelar</button>
      <button (click)="agregarChofer()">Guardar</button>
    </div>
  </div>
</div>

<div class="modal" *ngIf="modalAsignacion">
  <div class="modal-card">
    <h3>Asignar</h3>
    <select [(ngModel)]="nuevaAsignacion.camion">
      <option value="">Selecciona camión</option>
      <option *ngFor="let c of camiones" [value]="c.placa">{{ c.placa }} — {{ c.modelo }}</option>
    </select>

    <select [(ngModel)]="nuevaAsignacion.chofer">
      <option value="">Selecciona chofer</option>
      <option *ngFor="let ch of choferes" [value]="ch.nombre">{{ ch.nombre }}</option>
    </select>

    <input [(ngModel)]="nuevaAsignacion.ruta" placeholder="Ruta (nombre)" />
    <div class="modal-actions">
      <button (click)="modalAsignacion=false">Cancelar</button>
      <button (click)="agregarAsignacion()">Asignar</button>
    </div>
  </div>
</div>
